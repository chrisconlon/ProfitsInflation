# ProfitsInflation

Replication package for "Did Profits Cause Inflation?"

This repository contains Python and R code to replicate the analysis examining whether corporate profit growth drove post-pandemic inflation. The code downloads official government data, computes factor-share decompositions, and produces publication-quality charts and tables.

---

## Repository structure

```
ProfitsInflation/
├── config.ini.example            # API key template — copy to config.ini and fill in
├── requirements.txt              # Python dependencies
├── code/
│   ├── config_utils.R            # Shared R path/credential helper (sourced by all R scripts)
│   ├── install_packages.R        # Install all R dependencies (run once)
│   │
│   ├── 1_cpi_vs_ppi.ipynb        # [Python] CPI vs. PPI price comparison (BLS API)
│   ├── 2_NIPA Tables.ipynb       # [Python] NIPA factor-share decomposition (BEA)
│   │
│   ├── 00_download_wrds.R        # [R] Download Compustat data from WRDS to local parquet files
│   ├── 01_replicate_firm.R       # [R] Quarterly profit/margin plots for 18 named firms
│   ├── 02_aggregates.R           # [R] BEA aggregate price, cost, and profit series
│   ├── 03_compustat_time_dummies.R  # [R] Panel regression — full Compustat time dummies
│   ├── 04_top_firms_supermarket.R   # [R] Top supermarket/food/consumer-products firms (WRDS)
│   ├── 05_time_dummies_supermarket.R # [R] Panel regression — industry time dummies (WRDS)
│   ├── 06_naics_list.R           # [R] NAICS code reference table with top firms
│   ├── 07_qfr.R                  # [R] Census QFR profit margins by sector
│   ├── 08_top_firms_supermarket_gross.R  # [R] Gross profit margins for top firms (WRDS)
│   ├── 09_time_dummies_supermarket_gross.R # [R] Panel regression — gross margins (WRDS)
│   └── 10_pce_savings.R          # [R] Real PCE and personal savings rate (FRED API)
├── raw_data/
│   ├── markup_price_index.csv    # Alvarez-Blaser et al. (2025) markup/price indices
│   ├── price_costs_profit_per_unit.xlsx  # BEA price/cost/profit per unit (02)
│   ├── corporate_profits_by_industry.xlsx # BEA corporate profits by industry (02)
│   ├── gross_output_by_industry.xlsx      # BEA gross output by industry (02)
│   ├── 2-6 digit_2017_Codes.xlsx          # NAICS code crosswalk (06)
│   ├── compustat_fundq.parquet    # Compustat quarterly data (generated by 00)
│   ├── compustat_funda.parquet    # Compustat annual data (generated by 00)
│   └── qfr/
│       └── QFR-mf.csv            # Census Quarterly Financial Report (07)
├── proc_data/
│   ├── ppi.csv                   # Processed BLS data (generated by notebook 1)
│   └── 05_compustat_build.csv    # Compustat panel dataset (generated by script 05)
└── tables_and_figures/           # All output figures (.pdf, .png) and tables (.tex, .xlsx)
```

---

## Setup

### 1. Clone the repository

```bash
git clone https://github.com/chrisconlon/ProfitsInflation.git
cd ProfitsInflation
```

### 2. Configure API keys and credentials

Copy the template config file and fill in your credentials:

```bash
cp config.ini.example config.ini
```

Then edit `config.ini` with your keys (see the table below for where to obtain each).

> `config.ini` is listed in `.gitignore` and will never be committed.

| Key | Used by | How to obtain |
|-----|---------|---------------|
| `[api_keys] bls_api_key` | Python notebook 1 | Free — register at <https://data.bls.gov/registrationEngine/> |
| `[wrds] wrds_user / wrds_password` | R script 00 (one-time download) | Institutional subscription — <https://wrds-www.wharton.upenn.edu/> |
| `[fred] fred_api_key` | R script 10 | Free — register at <https://fred.stlouisfed.org/docs/api/api_key.html> |

The BEA data (Python notebook 2) is downloaded directly from a public URL — no key required.

---

## Python setup

Requires **Python 3.10+**.

```bash
python -m venv venv
source venv/bin/activate        # macOS / Linux
# venv\Scripts\activate         # Windows

pip install -r requirements.txt
```

Launch JupyterLab from the project root and run the notebooks **in order**:

```bash
jupyter lab
```

| Notebook | Description | Key outputs |
|----------|-------------|-------------|
| `1_cpi_vs_ppi.ipynb` | Downloads PPI/CPI from BLS, computes year-over-year changes | `proc_data/ppi.csv`, `cpi_vs_ppi.pdf`, `ppi_groundwork.pdf`, `ppi_trade_services.pdf`, `ppi_food.pdf` |
| `2_NIPA Tables.ipynb` | Downloads NIPA Table 1.15 from BEA, decomposes value-added growth into factor shares | `greedflation_bars.pdf`, `price_weights.pdf`, `profit_weights.pdf`, `nipa_table_115.tex`, `nipa_factor_shares.tex` |

---

## R setup

Requires **R 4.0+**.

Install all required packages by running once in R:

```r
source("code/install_packages.R")
```

Download Compustat data from WRDS (one-time step — saves `compustat_fundq.parquet` and `compustat_funda.parquet` to `raw_data/`):

```r
source("code/00_download_wrds.R")
```

Then run individual scripts from the project root (the `here` package automatically finds the root via the git directory):

```r
source("code/01_replicate_firm.R")
```

**Note:** Script 05 must be run before script 06 (it generates `proc_data/05_compustat_build.csv`).

| Script | Description | Requires | Key outputs |
|--------|-------------|----------|-------------|
| `00_download_wrds.R` | Download Compustat data from WRDS to local parquet files | WRDS | `raw_data/*.parquet` |
| `01_replicate_firm.R` | Profit and margin plots for 18 named firms | local parquet | `annual_margins.pdf` |
| `02_aggregates.R` | BEA aggregate price, cost, and profit series | raw Excel files | `aggregates.pdf` |
| `03_compustat_time_dummies.R` | Time dummies from panel regression, full Compustat | local parquet | `compustat_time_dummies.pdf` |
| `04_top_firms_supermarket.R` | Quarterly plots for top supermarket/food firms | local parquet | `supermarket_goods_quarterly_plots.pdf`, `supermarket_goods_annual_table.pdf` |
| `05_time_dummies_supermarket.R` | Time dummies by industry (supermarket, food, consumer products) | local parquet | `supermarket_goods_time_dummies.pdf`, `proc_data/05_compustat_build.csv` |
| `06_naics_list.R` | NAICS reference table with top firms per code | script 05 | `06_naics_compustat.xlsx` |
| `07_qfr.R` | Census QFR profit margins by sector | `raw_data/qfr/QFR-mf.csv` | `replicate_plot.pdf`, `qfr_profits.pdf` |
| `08_top_firms_supermarket_gross.R` | Gross profit margin plots for top firms | local parquet | `supermarket_goods_quarterly_plots_gross.pdf`, `supermarket_goods_annual_table_gross.pdf` |
| `09_time_dummies_supermarket_gross.R` | Time dummies on gross margins | local parquet | `supermarket_goods_time_dummies_gross.pdf` |
| `10_pce_savings.R` | Real PCE components and personal savings rate | FRED API key | `pce.pdf`, `personal_savings.pdf` |

---

## Data sources

| Source | Data | Access |
|--------|------|--------|
| [Bureau of Labor Statistics (BLS)](https://www.bls.gov/) | Producer Price Index (PPI), Consumer Price Index (CPI) | Free API — key required |
| [Bureau of Economic Analysis (BEA)](https://www.bea.gov/) | NIPA Table 1.15 — Value Added by Sector | Public download — no key required |
| [BEA](https://www.bea.gov/) | Price/cost/profit per unit, corporate profits, gross output by industry | Included in `raw_data/` |
| [Census Bureau QFR](https://www.census.gov/programs-surveys/qfr.html) | Quarterly Financial Report | Included in `raw_data/qfr/` |
| [WRDS / Compustat](https://wrds-www.wharton.upenn.edu/) | Firm-level quarterly and annual financials | Institutional subscription; downloaded once via `00_download_wrds.R` to local parquet files |
| [FRED](https://fred.stlouisfed.org/) | Real PCE components, personal savings rate | Free API — key required |
| Alvarez-Blaser et al. (2025) | Retail markup and price indices | Included in `raw_data/markup_price_index.csv` |

---

## Notes on reproducibility

- **Paths**: All file paths are constructed relative to the repository root — Python uses `pathlib.Path`, R uses the `here` package — so the code works on macOS, Linux, and Windows.
- **BLS data**: Notebook 1 fetches 2011–2025. Results update as new data is released. Pin `endyear` for a fixed snapshot.
- **BEA NIPA data**: Notebook 2 selects the 26 most recent quarters; this shifts as BEA releases new quarters.
- **Script ordering**: Run `05_time_dummies_supermarket.R` before `06_naics_list.R`.
